# Job Application Copilot - Architecture & State Machine

## System State Machine Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         INITIAL SETUP PHASE                              │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────┐
                    │   UNINITIALIZED STATE     │
                    │  (First Time User)        │
                    └───────────────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
        ┌──────────────────────┐      ┌──────────────────────┐
        │   SETUP WIZARD       │      │   MANUAL SETUP       │
        │  (Interactive CLI)   │      │   (Edit .env)        │
        └──────────────────────┘      └──────────────────────┘
                    │                               │
                    └───────────────┬───────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────┐
                    │   CONFIGURED STATE        │
                    │  (.env file populated)    │
                    └───────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         ONBOARDING PHASE                                 │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
        ┌──────────────────────┐      ┌──────────────────────┐
        │  RESUME UPLOAD       │      │  MANUAL ENTRY        │
        │  (TXT/DOCX)          │      │  (Interactive CLI)   │
        └──────────────────────┘      └──────────────────────┘
                    │                               │
                    │ AI Parsing                    │ User Input
                    │ (Claude 4.5)                  │
                    │                               │
                    └───────────────┬───────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────┐
                    │  PROFILE CREATED          │
                    │  - Work History           │
                    │  - Projects               │
                    │  - Skills                 │
                    │  - Education              │
                    │  - Canonical Answers      │
                    └───────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         JOB SOURCING PHASE                               │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
        ┌──────────────────────┐      ┌──────────────────────┐
        │  SEED SOURCES        │      │  CUSTOM SOURCES      │
        │  (58 pre-configured) │      │  (User added)        │
        └──────────────────────┘      └──────────────────────┘
                    │                               │
                    └───────────────┬───────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────┐
                    │   SOURCES READY           │
                    │  - 30 Greenhouse          │
                    │  - 20 Lever               │
                    │  - 3 RSS Feeds            │
                    │  - 3 Aggregators (APIs)   │
                    └───────────────────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────┐
                    │   SYNC JOBS               │
                    │  (Run: jobs sync)         │
                    └───────────────────────────┘
                                    │
                    ┌───────────────┼───────────────┐
                    │               │               │
                    ▼               ▼               ▼
        ┌──────────────┐ ┌──────────────┐ ┌──────────────┐
        │ Greenhouse   │ │   Lever      │ │  Aggregator  │
        │ Connector    │ │  Connector   │ │  Connector   │
        └──────────────┘ └──────────────┘ └──────────────┘
                    │               │               │
                    │ Rate Limiting │ Rate Limiting │
                    │               │               │
                    └───────────────┼───────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────┐
                    │  NORMALIZE & DEDUPE       │
                    │  (Hash-based)             │
                    └───────────────────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────┐
                    │   JOBS IN DATABASE        │
                    │  Status: NEW              │
                    └───────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                         JOB SELECTION PHASE                              │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
        ┌──────────────────────┐      ┌──────────────────────┐
        │   LIST JOBS          │      │   FILTER JOBS        │
        │  (All 3,518+)        │      │  (Remote/Company)    │
        └──────────────────────┘      └──────────────────────┘
                    │                               │
                    └───────────────┬───────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────┐
                    │   USER REVIEWS            │
                    │   (Manual Selection)      │
                    └───────────────────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────┐
                    │   QUEUE JOB               │
                    │  Status: NEW → QUEUED     │
                    └───────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                    AI DRAFT GENERATION PHASE                             │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
        ┌──────────────────────┐      ┌──────────────────────┐
        │  EXTRACT QUESTIONS   │      │  SKIP DRAFTS         │
        │  (User Input)        │      │  (Manual Apply)      │
        └──────────────────────┘      └──────────────────────┘
                    │                               │
                    ▼                               │
        ┌──────────────────────┐                   │
        │  AI GENERATION       │                   │
        │  (Claude 4.5 Haiku)  │                   │
        └──────────────────────┘                   │
                    │                               │
                    │ Generate 3 Variants:          │
                    │ 1. Direct                     │
                    │ 2. STAR (Story)               │
                    │ 3. Metrics-Focused            │
                    │                               │
                    ▼                               │
        ┌──────────────────────┐                   │
        │  CLAIM CHECKING      │                   │
        │  (Verify vs Profile) │                   │
        └──────────────────────┘                   │
                    │                               │
                    ▼                               │
        ┌──────────────────────┐                   │
        │  SAVE DRAFT ANSWERS  │                   │
        │  (Database: Q&A)     │                   │
        └──────────────────────┘                   │
                    │                               │
                    └───────────────┬───────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                    APPLICATION SUBMISSION PHASE                          │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    │                               │
                    ▼                               ▼
        ┌──────────────────────┐      ┌──────────────────────┐
        │  LAUNCH BROWSER      │      │  APPLICATION ERROR   │
        │  (Playwright)        │      │  (Retry/Skip)        │
        └──────────────────────┘      └──────────────────────┘
                    │
                    ▼
        ┌──────────────────────┐
        │  NAVIGATE TO JOB     │
        │  Status: IN_PROGRESS │
        └──────────────────────┘
                    │
                    ▼
        ┌──────────────────────┐
        │  DETECT FORM FIELDS  │
        │  (AI Field Detection)│
        └──────────────────────┘
                    │
                    ┌───────────┴────────────┐
                    │                        │
                    ▼                        ▼
        ┌──────────────────┐    ┌───────────────────┐
        │  SIMPLE FIELD    │    │  QUESTION FIELD   │
        │  (Name/Email)    │    │  (Essay/Custom)   │
        └──────────────────┘    └───────────────────┘
                    │                        │
                    │                        │ Show Draft
                    │                        │ Answer
                    │                        │
                    │                        ▼
                    │            ┌───────────────────┐
                    │            │  USER APPROVES    │
                    │            │  (Manual Review)  │
                    │            └───────────────────┘
                    │                        │
                    └────────────┬───────────┘
                                 │
                                 ▼
                    ┌──────────────────────┐
                    │  HUMAN STEP?         │
                    │  (CAPTCHA/2FA/File)  │
                    └──────────────────────┘
                                 │
                    ┌────────────┼────────────┐
                    │            │            │
                    ▼            ▼            ▼
        ┌──────────────┐ ┌──────────┐ ┌──────────┐
        │  CAPTCHA     │ │   2FA    │ │FILE      │
        │  DETECTED    │ │ DETECTED │ │UPLOAD    │
        └──────────────┘ └──────────┘ └──────────┘
                    │            │            │
                    └────────────┼────────────┘
                                 │
                                 ▼
                    ┌──────────────────────┐
                    │  PAUSE & NOTIFY      │
                    │  Status: PAUSED      │
                    │  (Desktop Alert)     │
                    └──────────────────────┘
                                 │
                                 ▼
                    ┌──────────────────────┐
                    │  USER COMPLETES      │
                    │  (Manual Action)     │
                    └──────────────────────┘
                                 │
                                 ▼
                    ┌──────────────────────┐
                    │  RESUME AUTOMATION   │
                    │  Status: IN_PROGRESS │
                    └──────────────────────┘
                                 │
                                 ▼
                    ┌──────────────────────┐
                    │  FORM COMPLETE       │
                    │  (All Fields Filled) │
                    └──────────────────────┘
                                 │
                                 ▼
                    ┌──────────────────────┐
                    │  FINAL CONFIRMATION  │
                    │  (User Must Approve) │
                    └──────────────────────┘
                                 │
                    ┌────────────┼────────────┐
                    │            │            │
                    ▼            ▼            ▼
        ┌──────────────┐ ┌──────────┐ ┌──────────┐
        │  SUBMIT      │ │  CANCEL  │ │  EDIT    │
        └──────────────┘ └──────────┘ └──────────┘
                    │            │            │
                    │            │            │
                    ▼            ▼            │
        ┌──────────────────────────┐         │
        │  APPLICATION SUBMITTED   │         │
        │  Status: COMPLETED       │         │
        └──────────────────────────┘         │
                    │                         │
                    │                         │
                    ▼                         │
        ┌──────────────────────┐             │
        │  AUDIT LOG           │             │
        │  (Track Submission)  │             │
        └──────────────────────┘             │
                    │                         │
                    └─────────────────────────┘
                                 │
                                 ▼
                    ┌──────────────────────┐
                    │   LOOP TO NEXT JOB   │
                    │   (Or Exit)          │
                    └──────────────────────┘
```

## Component State Diagrams

### 1. Job Sync State Machine

```
    START
      │
      ▼
┌──────────┐
│  IDLE    │
└──────────┘
      │
      │ User runs: jobs sync
      │
      ▼
┌──────────────┐
│ INITIALIZING │
│  - Get DB    │
│  - Get Cfg   │
└──────────────┘
      │
      ▼
┌──────────────┐
│ GET SOURCES  │
│  (58 total)  │
└──────────────┘
      │
      ▼
┌──────────────┐     ┌─────────────┐
│ FOR EACH     │────►│  SYNCING    │
│ SOURCE       │     │  (Rate Lim) │
└──────────────┘     └─────────────┘
      │                     │
      │                     ▼
      │              ┌─────────────┐
      │              │ NORMALIZE   │
      │              └─────────────┘
      │                     │
      │                     ▼
      │              ┌─────────────┐
      │              │ DEDUPE      │
      │              │ (Hash Check)│
      │              └─────────────┘
      │                     │
      │              ┌──────┴──────┐
      │              │             │
      │              ▼             ▼
      │        ┌──────────┐  ┌──────────┐
      │        │   NEW    │  │  SKIP    │
      │        │  (Save)  │  │(Duplicate)│
      │        └──────────┘  └──────────┘
      │              │             │
      │              └──────┬──────┘
      │                     │
      └─────────────────────┘
      │
      ▼
┌──────────────┐
│  COMPLETE    │
│  (Stats)     │
└──────────────┘
```

### 2. Draft Generation State Machine

```
    START
      │
      ▼
┌──────────────┐
│ GET JOB      │
│ (By ID)      │
└──────────────┘
      │
      ▼
┌──────────────┐
│ LOAD PROFILE │
│  - Work      │
│  - Projects  │
│  - Skills    │
└──────────────┘
      │
      ▼
┌──────────────┐
│ GET QUESTIONS│
│ (User Input) │
└──────────────┘
      │
      ▼
┌──────────────────┐
│ FOR EACH Q       │
└──────────────────┘
      │
      ▼
┌──────────────────┐
│ GENERATE DRAFTS  │
│  - Direct        │
│  - STAR          │
│  - Metrics       │
└──────────────────┘
      │
      ▼
┌──────────────────┐
│ CLAIM CHECK      │
│  - Verify facts  │
│  - Flag unknowns │
└──────────────────┘
      │
      ▼
┌──────────────────┐
│ SAVE TO DB       │
│  (Q&A Pairs)     │
└──────────────────┘
      │
      ▼
    DONE
```

### 3. Browser Automation State Machine

```
    START
      │
      ▼
┌──────────────┐
│ LAUNCH       │
│ BROWSER      │
└──────────────┘
      │
      ▼
┌──────────────┐
│ NAVIGATE     │
│ TO URL       │
└──────────────┘
      │
      ▼
┌──────────────┐
│ DETECT       │
│ ELEMENTS     │
└──────────────┘
      │
      ┌─────┴─────┐
      │           │
      ▼           ▼
┌──────────┐ ┌──────────┐
│  FORM    │ │  HUMAN   │
│  FIELD   │ │  STEP    │
└──────────┘ └──────────┘
      │           │
      │           ▼
      │     ┌──────────┐
      │     │  PAUSE   │
      │     │  NOTIFY  │
      │     └──────────┘
      │           │
      │           ▼
      │     ┌──────────┐
      │     │  WAIT    │
      │     │  USER    │
      │     └──────────┘
      │           │
      └─────┬─────┘
            │
            ▼
      ┌──────────┐
      │  FILL    │
      │  FIELD   │
      └──────────┘
            │
            ▼
      ┌──────────┐
      │  ALL     │
      │  DONE?   │
      └──────────┘
            │
      ┌─────┴─────┐
      │           │
      ▼           ▼
     NO          YES
      │           │
      │           ▼
      │     ┌──────────┐
      │     │ CONFIRM  │
      │     │ SUBMIT   │
      │     └──────────┘
      │           │
      │           ▼
      │     ┌──────────┐
      │     │ SUBMIT   │
      │     └──────────┘
      │           │
      │           ▼
      │     ┌──────────┐
      │     │  AUDIT   │
      │     │  LOG     │
      │     └──────────┘
      │           │
      └───────────┘
            │
            ▼
          DONE
```

## Data Flow Diagram

```
┌─────────────┐
│   SOURCES   │
│  (58 URLs)  │
└─────────────┘
       │
       ▼
┌─────────────┐     ┌─────────────┐
│ CONNECTORS  │────►│   JOBS DB   │
│  - GH       │     │  (SQLite)   │
│  - Lever    │     │             │
│  - RSS      │     │  - New      │
│  - API      │     │  - Reviewed │
└─────────────┘     │  - Queued   │
       │            │  - Applied  │
       │            └─────────────┘
       │                   │
       ▼                   ▼
┌─────────────┐     ┌─────────────┐
│  PROFILE    │     │   Q&A DB    │
│   - Work    │     │  (Drafts)   │
│   - Skills  │     └─────────────┘
│   - Projects│            │
└─────────────┘            │
       │                   │
       └────────┬──────────┘
                │
                ▼
         ┌─────────────┐
         │   AI GEN    │
         │  (Claude)   │
         └─────────────┘
                │
                ▼
         ┌─────────────┐
         │   BROWSER   │
         │ (Playwright)│
         └─────────────┘
                │
                ▼
         ┌─────────────┐
         │    USER     │
         │  (Approval) │
         └─────────────┘
                │
                ▼
         ┌─────────────┐
         │  SUBMITTED  │
         │ APPLICATION │
         └─────────────┘
```

## Key State Transitions

### Job Status Flow
```
NEW → REVIEWED → QUEUED → IN_PROGRESS → COMPLETED
                    ↓
                 REJECTED
                    ↓
                 ARCHIVED
```

### Application Status Flow
```
QUEUED → IN_PROGRESS → PAUSED → IN_PROGRESS → COMPLETED
           ↓                                      ↓
         FAILED ←──────────────────────────────────
```

### Human Step Types
```
CAPTCHA    - User must solve CAPTCHA
2FA        - Two-factor authentication required
FILE       - File upload needed
CONSENT    - Agreement/checkbox confirmation
UNKNOWN    - Unrecognized human step
```

## Error Handling States

```
         ┌──────────┐
         │  ERROR   │
         └──────────┘
              │
   ┌──────────┼──────────┐
   │          │          │
   ▼          ▼          ▼
┌──────┐  ┌──────┐  ┌──────┐
│RETRY │  │ SKIP │  │ FAIL │
└──────┘  └──────┘  └──────┘
   │          │          │
   │          │          ▼
   │          │     ┌──────┐
   │          │     │ LOG  │
   │          │     └──────┘
   │          │
   └────┬─────┘
        │
        ▼
    CONTINUE
```
